# Excel 2016 系统测试用例设计文档

## 文档说明
- **适用版本**: Microsoft Excel 2016
- **创建日期**: 2026-01-07
- **文档版本**: v1.0
- **测试范围**: 基础公式、组合公式、表头场景、边界测试

---

## 目录
1. [Excel 2016 功能特性](#excel-2016-功能特性)
2. [基础公式测试用例](#基础公式测试用例)
3. [组合公式测试用例](#组合公式测试用例)
4. [表头场景测试用例](#表头场景测试用例)
5. [边界条件测试用例](#边界条件测试用例)
6. [实际业务场景](#实际业务场景)
7. [测试数据准备](#测试数据准备)

---

## Excel 2016 功能特性

### 支持的功能
- ✅ 传统数组公式（需Ctrl+Shift+Enter）
- ✅ VLOOKUP/HLOOKUP查找函数
- ✅ INDEX/MATCH组合
- ✅ SUMIF/SUMIFS/COUNTIF/COUNTIFS
- ✅ Power Query（获取和转换）
- ✅ Power Pivot（数据模型）
- ✅ 条件格式
- ✅ 数据透视表

### 不支持的功能（Excel 365特性）
- ❌ XLOOKUP（使用VLOOKUP或INDEX+MATCH替代）
- ❌ 动态数组（FILTER, SORT, UNIQUE等）
- ❌ LET函数
- ❌ TEXTJOIN（使用CONCATENATE或&替代）
- ❌ IFS（使用嵌套IF替代）
- ❌ SWITCH（使用嵌套IF或CHOOSE替代）

### 系统限制
- 最大行数: 1,048,576
- 最大列数: 16,384 (XFD列)
- 公式长度: 8,192个字符
- 嵌套层数: 64层

---

## 1. 基础公式测试用例

### 1.1 数学与统计函数

| 用例ID | 公式 | 测试数据 | 预期结果 | 验证点 | 优先级 |
|--------|------|----------|----------|--------|--------|
| TC-001 | `=SUM(A1:A10)` | 1,2,3...10 | 55 | 基础求和 | P0 |
| TC-002 | `=AVERAGE(B1:B5)` | 10,20,30,40,50 | 30 | 平均值计算 | P0 |
| TC-003 | `=MAX(C1:C10)` | 随机数1-100 | 最大值 | 最大值查找 | P0 |
| TC-004 | `=MIN(D1:D10)` | 随机数1-100 | 最小值 | 最小值查找 | P0 |
| TC-005 | `=COUNT(E1:E20)` | 混合数字和文本 | 数字单元格数 | 数值计数 | P0 |
| TC-006 | `=COUNTA(F1:F20)` | 包含空白单元格 | 非空单元格数 | 非空计数 | P0 |
| TC-007 | `=COUNTBLANK(G1:G20)` | 包含空白单元格 | 空单元格数 | 空值计数 | P1 |
| TC-008 | `=MEDIAN(H1:H9)` | 1,2,3,4,5,6,7,8,9 | 5 | 中位数 | P1 |
| TC-009 | `=ROUND(I1, 2)` | 3.14159 | 3.14 | 四舍五入 | P0 |
| TC-010 | `=ROUNDUP(J1, 2)` | 3.141 | 3.15 | 向上取整 | P1 |
| TC-011 | `=ROUNDDOWN(K1, 2)` | 3.149 | 3.14 | 向下取整 | P1 |
| TC-012 | `=ABS(L1)` | -100 | 100 | 绝对值 | P0 |
| TC-013 | `=MOD(M1, M2)` | M1=10, M2=3 | 1 | 取余数 | P1 |
| TC-014 | `=POWER(N1, 2)` | 5 | 25 | 幂运算 | P1 |
| TC-015 | `=SQRT(O1)` | 16 | 4 | 平方根 | P1 |
| TC-016 | `=PRODUCT(P1:P5)` | 2,3,4,5,6 | 720 | 乘积 | P1 |
| TC-017 | `=STDEV.S(Q1:Q10)` | 数值序列 | 标准差 | 样本标准差 | P2 |
| TC-018 | `=STDEV.P(R1:R10)` | 数值序列 | 标准差 | 总体标准差 | P2 |

### 1.2 逻辑函数

| 用例ID | 公式 | 测试数据 | 预期结果 | 验证点 | 优先级 |
|--------|------|----------|----------|--------|--------|
| TC-019 | `=IF(A1>60, "及格", "不及格")` | A1=75 | "及格" | 单条件判断 | P0 |
| TC-020 | `=IF(B1="", "空值", B1)` | B1为空 | "空值" | 空值判断 | P0 |
| TC-021 | `=AND(C1>0, C2>0)` | C1=5, C2=10 | TRUE | 与逻辑 | P0 |
| TC-022 | `=OR(D1<0, D2<0)` | D1=5, D2=-3 | TRUE | 或逻辑 | P0 |
| TC-023 | `=NOT(E1=0)` | E1=10 | TRUE | 非逻辑 | P1 |
| TC-024 | `=IFERROR(F1/F2, 0)` | F1=10, F2=0 | 0 | 错误处理 | P0 |
| TC-025 | `=IFNA(MATCH(G1,A:A,0), "未找到")` | G1不在列表 | "未找到" | NA错误处理 | P1 |
| TC-026 | `=ISNUMBER(H1)` | H1=123 | TRUE | 判断是否数字 | P1 |
| TC-027 | `=ISTEXT(I1)` | I1="文本" | TRUE | 判断是否文本 | P1 |
| TC-028 | `=ISBLANK(J1)` | J1为空 | TRUE | 判断是否空白 | P1 |

### 1.3 文本函数

| 用例ID | 公式 | 测试数据 | 预期结果 | 验证点 | 优先级 |
|--------|------|----------|----------|--------|--------|
| TC-029 | `=CONCATENATE(A1, B1)` | A1="Hello", B1="World" | "HelloWorld" | 文本连接 | P0 |
| TC-030 | `=A1&B1&C1` | "2024"、"-"、"01" | "2024-01" | &运算符连接 | P0 |
| TC-031 | `=LEFT(D1, 3)` | "Excel2016" | "Exc" | 左侧提取 | P0 |
| TC-032 | `=RIGHT(E1, 4)` | "Excel2016" | "2016" | 右侧提取 | P0 |
| TC-033 | `=MID(F1, 2, 3)` | "Testing" | "est" | 中间提取 | P0 |
| TC-034 | `=LEN(G1)` | "Hello" | 5 | 长度计算 | P0 |
| TC-035 | `=UPPER(H1)` | "hello" | "HELLO" | 转大写 | P1 |
| TC-036 | `=LOWER(I1)` | "WORLD" | "world" | 转小写 | P1 |
| TC-037 | `=PROPER(J1)` | "hello world" | "Hello World" | 首字母大写 | P1 |
| TC-038 | `=TRIM(K1)` | "  text  " | "text" | 去除空格 | P0 |
| TC-039 | `=SUBSTITUTE(L1, "a", "b")` | "banana" | "bbnbnb" | 文本替换 | P1 |
| TC-040 | `=REPLACE(M1, 2, 3, "XXX")` | "Testing" | "TXXXing" | 文本替换 | P1 |
| TC-041 | `=FIND("x", N1)` | "Excel" | 2 | 查找位置(区分大小写) | P1 |
| TC-042 | `=SEARCH("x", O1)` | "Excel" | 2 | 查找位置(不区分) | P1 |
| TC-043 | `=TEXT(P1, "0.00")` | 123.456 | "123.46" | 数字格式化 | P1 |
| TC-044 | `=VALUE(Q1)` | "123" | 123 | 文本转数字 | P1 |

### 1.4 查找与引用函数

| 用例ID | 公式 | 测试数据 | 预期结果 | 验证点 | 优先级 |
|--------|------|----------|----------|--------|--------|
| TC-045 | `=VLOOKUP(E1, A1:C10, 2, FALSE)` | 查找表存在 | 精确匹配值 | 垂直查找-精确 | P0 |
| TC-046 | `=VLOOKUP(E2, A1:C10, 2, TRUE)` | 查找表有序 | 近似匹配值 | 垂直查找-近似 | P0 |
| TC-047 | `=VLOOKUP(E3, A1:C10, 2, 0)` | 查找值不存在 | #N/A | 查找失败处理 | P0 |
| TC-048 | `=HLOOKUP(F1, A1:J3, 2, FALSE)` | 横向查找表 | 对应值 | 水平查找 | P1 |
| TC-049 | `=INDEX(A1:C10, 3, 2)` | 数据区域存在 | 第3行第2列值 | 索引查找 | P0 |
| TC-050 | `=MATCH(G1, A1:A10, 0)` | G1="张三" | 位置序号 | 精确匹配位置 | P0 |
| TC-051 | `=MATCH(G2, A1:A10, 1)` | 升序数据 | 位置序号 | 升序匹配 | P1 |
| TC-052 | `=MATCH(G3, A1:A10, -1)` | 降序数据 | 位置序号 | 降序匹配 | P1 |
| TC-053 | `=INDEX(B1:B10, MATCH(H1, A1:A10, 0))` | 组合使用 | 对应值 | INDEX+MATCH组合 | P0 |
| TC-054 | `=OFFSET(A1, 2, 3, 5, 2)` | 基准点A1 | 偏移后区域 | 动态引用 | P1 |
| TC-055 | `=INDIRECT("B" & A1)` | A1=5 | B5的值 | 间接引用 | P1 |
| TC-056 | `=CHOOSE(C1, "A", "B", "C")` | C1=2 | "B" | 选择函数 | P1 |
| TC-057 | `=ROW()` | 当前行 | 行号 | 获取行号 | P1 |
| TC-058 | `=COLUMN()` | 当前列 | 列号 | 获取列号 | P1 |

### 1.5 日期与时间函数

| 用例ID | 公式 | 测试数据 | 预期结果 | 验证点 | 优先级 |
|--------|------|----------|----------|--------|--------|
| TC-059 | `=TODAY()` | 无 | 当前日期 | 今天日期 | P0 |
| TC-060 | `=NOW()` | 无 | 当前日期时间 | 当前时间 | P0 |
| TC-061 | `=YEAR(A1)` | 2024-01-15 | 2024 | 提取年份 | P0 |
| TC-062 | `=MONTH(B1)` | 2024-01-15 | 1 | 提取月份 | P0 |
| TC-063 | `=DAY(C1)` | 2024-01-15 | 15 | 提取日期 | P0 |
| TC-064 | `=DATE(2024, 1, 15)` | 无 | 2024-01-15 | 构造日期 | P0 |
| TC-065 | `=DATEDIF(D1, D2, "D")` | 2024-01-01至2024-12-31 | 365 | 日期差-天数 | P1 |
| TC-066 | `=DATEDIF(E1, E2, "M")` | 2024-01-01至2024-12-31 | 11 | 日期差-月数 | P1 |
| TC-067 | `=DATEDIF(F1, F2, "Y")` | 2020-01-01至2024-01-01 | 4 | 日期差-年数 | P1 |
| TC-068 | `=WEEKDAY(G1)` | 2024-01-01 | 1-7 | 星期几 | P1 |
| TC-069 | `=WEEKDAY(G1, 2)` | 2024-01-01 | 1=周一 | 星期几(周一为1) | P1 |
| TC-070 | `=EOMONTH(H1, 0)` | 2024-01-15 | 2024-01-31 | 月末日期 | P1 |
| TC-071 | `=EOMONTH(I1, 1)` | 2024-01-15 | 2024-02-29 | 下月月末 | P1 |
| TC-072 | `=WORKDAY(J1, 10)` | 2024-01-01 | 10个工作日后 | 工作日计算 | P1 |
| TC-073 | `=NETWORKDAYS(K1, K2)` | 起止日期 | 工作日天数 | 工作日统计 | P1 |
| TC-074 | `=TIME(14, 30, 0)` | 无 | 14:30:00 | 构造时间 | P2 |
| TC-075 | `=HOUR(L1)` | 14:30:45 | 14 | 提取小时 | P2 |

---

## 2. 组合公式测试用例

### 2.1 嵌套IF组合（Excel 2016无IFS函数）

| 用例ID | 公式 | 测试数据 | 预期结果 | 验证点 | 优先级 |
|--------|------|----------|----------|--------|--------|
| TC-076 | `=IF(A1>=90,"优秀",IF(A1>=80,"良好",IF(A1>=60,"及格","不及格")))` | A1=85 | "良好" | 4层嵌套IF | P0 |
| TC-077 | `=IF(AND(B1>0,B2>0,B3>0),"全正","有负")` | B1=5,B2=10,B3=3 | "全正" | IF+AND组合 | P0 |
| TC-078 | `=IF(OR(C1="A",C1="B",C1="C"),"通过","不通过")` | C1="B" | "通过" | IF+OR组合 | P0 |
| TC-079 | `=IF(D1="","空值",IF(D1>100,"大","小"))` | D1=150 | "大" | 空值+数值判断 | P0 |
| TC-080 | `=IF(ISNUMBER(E1),E1*2,"非数字")` | E1=50 | 100 | IF+ISNUMBER | P1 |

### 2.2 VLOOKUP高级组合

| 用例ID | 公式 | 测试数据 | 预期结果 | 验证点 | 优先级 |
|--------|------|----------|----------|--------|--------|
| TC-081 | `=IFERROR(VLOOKUP(A1,$D$1:$F$100,2,0),"未找到")` | A1不在表中 | "未找到" | 查找错误处理 | P0 |
| TC-082 | `=VLOOKUP(B1,$G$1:$I$100,MATCH("销售额",$G$1:$I$1,0),0)` | 动态列号 | 对应值 | 动态列查找 | P1 |
| TC-083 | `=SUMIF($A:$A,C1,$B:$B)` | C1为条件 | 条件求和 | SUMIF基础 | P0 |
| TC-084 | `=VLOOKUP(D1&E1,$F:$H,3,0)` | 双字段组合查找 | 对应值 | 组合键查找 | P1 |

### 2.3 INDEX+MATCH组合（替代VLOOKUP）

| 用例ID | 公式 | 测试数据 | 预期结果 | 验证点 | 优先级 |
|--------|------|----------|----------|--------|--------|
| TC-085 | `=INDEX(C1:C100,MATCH(A1,B1:B100,0))` | 左侧查找 | 对应值 | 左侧列查找 | P0 |
| TC-086 | `=INDEX(D1:F100,MATCH(A2,D1:D100,0),MATCH("目标列",D1:F1,0))` | 行列双匹配 | 对应值 | 二维查找 | P1 |
| TC-087 | `=INDEX(G1:G100,MATCH(MAX(H1:H100),H1:H100,0))` | 最大值对应项 | 名称 | 最值查找 | P1 |
| TC-088 | `=INDEX(I1:I100,MATCH(MIN(J1:J100),J1:J100,0))` | 最小值对应项 | 名称 | 最小值查找 | P1 |

### 2.4 条件统计函数组合

| 用例ID | 公式 | 测试数据 | 预期结果 | 验证点 | 优先级 |
|--------|------|----------|----------|--------|--------|
| TC-089 | `=SUMIF(A:A,">100",B:B)` | A列条件,B列求和 | 符合条件和 | 单条件求和 | P0 |
| TC-090 | `=SUMIFS(C:C,D:D,"北京",E:E,">1000")` | 多条件 | 多条件求和 | 双条件求和 | P0 |
| TC-091 | `=COUNTIF(F:F,"及格")` | F列数据 | 符合数量 | 单条件计数 | P0 |
| TC-092 | `=COUNTIFS(G:G,">=60",G:G,"<80")` | G列数据 | 区间计数 | 区间统计 | P1 |
| TC-093 | `=AVERAGEIF(H:H,">0",I:I)` | H列条件,I列平均 | 条件平均值 | 条件平均 | P1 |
| TC-094 | `=AVERAGEIFS(J:J,K:K,"A",L:L,">100")` | 多条件 | 多条件平均 | 双条件平均 | P1 |

### 2.5 文本处理组合（Excel 2016无TEXTJOIN）

| 用例ID | 公式 | 测试数据 | 预期结果 | 验证点 | 优先级 |
|--------|------|----------|----------|--------|--------|
| TC-095 | `=A1&"-"&B1&"-"&C1` | "2024","01","15" | "2024-01-15" | 多段连接 | P0 |
| TC-096 | `=CONCATENATE(D1," ",E1," ",F1)` | 姓名三段 | "张 三 丰" | CONCATENATE多段 | P0 |
| TC-097 | `=UPPER(LEFT(G1,1))&LOWER(MID(G1,2,100))` | "hELLO" | "Hello" | 首字母大写 | P1 |
| TC-098 | `=TRIM(SUBSTITUTE(H1,CHAR(10)," "))` | 包含换行符 | 替换换行 | 特殊字符处理 | P1 |
| TC-099 | `=TEXT(I1,"yyyy-mm-dd")` | 数值日期 | "2024-01-15" | 日期格式化 | P1 |
| TC-100 | `=TEXT(J1,"#,##0.00")` | 12345.6 | "12,345.60" | 数值格式化 | P1 |

### 2.6 数组公式（需按Ctrl+Shift+Enter）

| 用例ID | 公式 | 输入方式 | 预期结果 | 验证点 | 优先级 |
|--------|------|----------|----------|--------|--------|
| TC-101 | `=SUM((A1:A10>5)*(B1:B10))` | Ctrl+Shift+Enter | 条件求和 | 数组条件求和 | P1 |
| TC-102 | `=MAX(IF(C1:C10="A",D1:D10))` | Ctrl+Shift+Enter | 最大值 | 条件最大值 | P1 |
| TC-103 | `=SUM((E1:E10="北京")*(F1:F10>100)*G1:G10)` | Ctrl+Shift+Enter | 双条件求和 | 复杂条件数组 | P2 |
| TC-104 | `=AVERAGE(IF(H1:H10<>"",H1:H10))` | Ctrl+Shift+Enter | 平均值 | 忽略空值平均 | P1 |

### 2.7 SUMPRODUCT组合（不需要数组公式）

| 用例ID | 公式 | 测试数据 | 预期结果 | 验证点 | 优先级 |
|--------|------|----------|----------|--------|--------|
| TC-105 | `=SUMPRODUCT((A1:A10="A")*(B1:B10))` | A列条件,B列求和 | 条件求和 | 单条件 | P1 |
| TC-106 | `=SUMPRODUCT((C1:C10>100)*(D1:D10<200)*E1:E10)` | 双区间条件 | 区间求和 | 双条件 | P1 |
| TC-107 | `=SUMPRODUCT(F1:F10,G1:G10)` | 数量*单价 | 总金额 | 乘积求和 | P1 |
| TC-108 | `=SUMPRODUCT((H1:H10="北京")*(I1:I10))` | 地区筛选 | 地区总额 | 分类汇总 | P1 |

### 2.8 日期时间组合

| 用例ID | 公式 | 测试数据 | 预期结果 | 验证点 | 优先级 |
|--------|------|----------|----------|--------|--------|
| TC-109 | `=DATEDIF(A1,TODAY(),"Y")&"年"&DATEDIF(A1,TODAY(),"YM")&"月"` | A1为生日 | "25年3月" | 计算年龄 | P1 |
| TC-110 | `=IF(WEEKDAY(B1)=1,"周日",IF(WEEKDAY(B1)=7,"周六","工作日"))` | B1为日期 | 星期类型 | 工作日判断 | P1 |
| TC-111 | `=EOMONTH(C1,0)` | C1为日期 | 月末日期 | 月末计算 | P1 |
| TC-112 | `=DATE(YEAR(D1),MONTH(D1)+1,1)-1` | D1为日期 | 月末日期 | 手动月末 | P2 |
| TC-113 | `=NETWORKDAYS(E1,E2)` | 起止日期 | 工作日数 | 工作日统计 | P1 |

---

## 3. 表头场景测试用例

### 3.1 场景A：固定表头（最常见）

#### 数据结构
```
   A      B      C      D      E
1  姓名   语文   数学   英语   总分
2  张三   85     90     88     =SUM(B2:D2)
3  李四   92     87     95     =SUM(B3:D3)
4  王五   78     85     82     =SUM(B4:D4)
5  总计   =SUM(B2:B4)  =SUM(C2:C4)  =SUM(D2:D4)  =SUM(E2:E4)
```

| 用例ID | 公式位置 | 公式内容 | 预期结果 | 测试场景 | 优先级 |
|--------|----------|----------|----------|----------|--------|
| TC-114 | E2 | `=SUM(B2:D2)` | 263 | 行求和 | P0 |
| TC-115 | B5 | `=SUM(B2:B4)` | 255 | 列求和 | P0 |
| TC-116 | F2 | `=AVERAGE(B2:D2)` | 87.67 | 行平均 | P0 |
| TC-117 | E5 | `=SUM(B2:D4)` | 总分汇总 | 全表求和 | P0 |
| TC-118 | G2 | `=RANK(E2,$E$2:$E$4)` | 排名 | 成绩排名 | P1 |
| TC-119 | H2 | `=IF(F2>=90,"优秀",IF(F2>=80,"良好","及格"))` | 等级 | 等级判断 | P0 |
| TC-120 | I2 | `=VLOOKUP(A2,$A$2:$E$4,5,0)` | 总分 | 查找总分 | P1 |
| TC-121 | B6 | `=AVERAGE(B2:B4)` | 平均分 | 科目平均 | P0 |
| TC-122 | B7 | `=MAX(B2:B4)` | 最高分 | 科目最高 | P0 |
| TC-123 | B8 | `=MIN(B2:B4)` | 最低分 | 科目最低 | P0 |

### 3.2 场景B：动态表头（日期/月份变量）

#### 数据结构
```
   A        B         C         D         E
1  产品     2024-01   2024-02   2024-03   合计
2  产品A    1000      1200      1100      =SUM(B2:D2)
3  产品B    800       850       900       =SUM(B3:D3)
4  产品C    1500      1600      1550      =SUM(B4:D4)
5  月总计   =SUM(B2:B4)  =SUM(C2:C4)  =SUM(D2:D4)  =SUM(E2:E4)
```

| 用例ID | 公式位置 | 公式内容 | 预期结果 | 测试场景 | 优先级 |
|--------|----------|----------|----------|----------|--------|
| TC-124 | E2 | `=SUM(B2:D2)` | 3300 | 产品总销售 | P0 |
| TC-125 | B5 | `=SUM(B2:B4)` | 3300 | 月度总计 | P0 |
| TC-126 | F2 | `=AVERAGE(B2:D2)` | 1100 | 月均销售 | P1 |
| TC-127 | G2 | `=MAX(B2:D2)` | 1200 | 最高月销售 | P1 |
| TC-128 | H2 | `=(D2-B2)/B2` | 10% | 环比增长 | P1 |
| TC-129 | I2 | `=INDEX(B1:D1,MATCH(MAX(B2:D2),B2:D2,0))` | 最大月份 | 最佳月份 | P2 |
| TC-130 | J2 | `=COUNTIF(B2:D2,">1000")` | 大于1000月数 | 达标月数 | P1 |
| TC-131 | B6 | `=B5/SUM($B$5:$D$5)` | 占比 | 月度占比 | P1 |

### 3.3 场景C：多级表头

#### 数据结构
```
   A      B        C        D        E        F
1  姓名   第一季度 第一季度 第二季度 第二季度 总计
2         销售额   利润     销售额   利润
3  张三   10000    2000     12000    2400     =SUM(B3:E3)
4  李四   8000     1600     9000     1800     =SUM(B4:E4)
```

| 用例ID | 公式位置 | 公式内容 | 预期结果 | 测试场景 | 优先级 |
|--------|----------|----------|----------|----------|--------|
| TC-132 | F3 | `=SUM(B3:E3)` | 全年总计 | 26400 | P0 |
| TC-133 | G3 | `=SUM(B3:C3)` | Q1小计 | 12000 | P0 |
| TC-134 | H3 | `=SUM(D3:E3)` | Q2小计 | 14400 | P0 |
| TC-135 | B5 | `=SUM(B3:B4)` | 销售总额 | 18000 | P0 |
| TC-136 | C5 | `=C3/B3` | 利润率 | 20% | P1 |
| TC-137 | I3 | `=(D3-B3)/B3` | 季度增长率 | 20% | P1 |

### 3.4 场景D：交叉透视表

#### 数据结构
```
   A      B        C        D        E
1  地区\  产品A    产品B    产品C    总计
2  北京   100      200      150      =SUM(B2:D2)
3  上海   120      180      160      =SUM(B3:D3)
4  广州   90       220      140      =SUM(B4:D4)
5  总计   =SUM(B2:B4)  =SUM(C2:C4)  =SUM(D2:D4)  =SUM(E2:E4)
```

| 用例ID | 公式位置 | 公式内容 | 预期结果 | 测试场景 | 优先级 |
|--------|----------|----------|----------|----------|--------|
| TC-138 | E2 | `=SUM(B2:D2)` | 450 | 地区总计 | P0 |
| TC-139 | B5 | `=SUM(B2:B4)` | 310 | 产品总计 | P0 |
| TC-140 | E5 | `=SUM(B2:D4)` | 总计 | 全表总计 | P0 |
| TC-141 | F2 | `=E2/$E$5` | 占比 | 地区占比 | P1 |
| TC-142 | B6 | `=B5/SUM($B$5:$D$5)` | 占比 | 产品占比 | P1 |
| TC-143 | G2 | `=MAX(B2:D2)` | 150 | 地区最高产品 | P1 |
| TC-144 | H2 | `=INDEX($B$1:$D$1,MATCH(MAX(B2:D2),B2:D2,0))` | "产品C" | 最佳产品名 | P2 |

### 3.5 场景E：不规则表头（含合并单元格）

#### 数据结构
```
   A          B      C      D
1  销售报表（合并A1:D1）
2
3  项目       Q1     Q2     总计
4  收入       1000   1200   =B4+C4
5  成本       800    900    =B5+C5
6  利润       =B4-B5 =C4-C5 =D4-D5
```

| 用例ID | 公式位置 | 公式内容 | 预期结果 | 测试场景 | 优先级 |
|--------|----------|----------|----------|----------|--------|
| TC-145 | D4 | `=B4+C4` | 2200 | 行合计 | P0 |
| TC-146 | B6 | `=B4-B5` | 200 | 列计算 | P0 |
| TC-147 | D6 | `=D4-D5` | 500 | 总利润 | P0 |
| TC-148 | B7 | `=B6/B4` | 20% | 利润率 | P1 |
| TC-149 | E4 | `=INDIRECT("B"&ROW())` | 1000 | 动态引用 | P2 |

### 3.6 场景F：表头在中间（上下都有数据）

#### 数据结构
```
   A      B      C
1  摘要   金额
2  收入   5000
3  支出   3000
4
5  明细   金额   备注
6  项目A  2000   重要
7  项目B  1500
```

| 用例ID | 公式位置 | 公式内容 | 预期结果 | 测试场景 | 优先级 |
|--------|----------|----------|----------|----------|--------|
| TC-150 | B3 | `=SUM(B6:B7)` | 3500 | 跨表头求和 | P1 |
| TC-151 | B2 | `=B3+2000` | 5000 | 反向计算 | P1 |
| TC-152 | D2 | `=B2-B3` | 2000 | 净额 | P0 |

---

## 4. 边界条件测试用例

### 4.1 空值与错误处理

| 用例ID | 测试场景 | 公式示例 | 测试数据 | 预期结果 | 优先级 |
|--------|----------|----------|----------|----------|--------|
| TC-153 | 空单元格求和 | `=SUM(A1:A10)` | 包含5个空单元格 | 只计算非空 | P0 |
| TC-154 | 空单元格平均 | `=AVERAGE(B1:B10)` | 包含5个空单元格 | 只计算非空平均 | P0 |
| TC-155 | 除零错误 | `=IFERROR(C1/C2, "错误")` | C2=0 | "错误" | P0 |
| TC-156 | 查找失败 | `=IFERROR(VLOOKUP(D1,A:B,2,0),"未找到")` | D1不存在 | "未找到" | P0 |
| TC-157 | NA错误 | `=IFNA(MATCH(E1,A:A,0),"不存在")` | E1不在列表 | "不存在" | P1 |
| TC-158 | 空文本判断 | `=IF(F1="","空",F1)` | F1为空 | "空" | P0 |
| TC-159 | 空值计数 | `=COUNTBLANK(G1:G20)` | 包含空单元格 | 空单元格数 | P1 |
| TC-160 | 忽略错误求和 | `=SUMIF(H1:H10,"<9E+307")` | 包含#DIV/0! | 忽略错误 | P2 |

### 4.2 数据类型边界

| 用例ID | 测试场景 | 公式示例 | 测试数据 | 预期结果 | 优先级 |
|--------|----------|----------|----------|----------|--------|
| TC-161 | 文本型数字 | `=SUM(A1:A5)` | "1","2","3",4,5 | 9（忽略文本） | P0 |
| TC-162 | 数字转文本 | `=TEXT(B1,"0")` | 123.45 | "123" | P1 |
| TC-163 | 文本转数字 | `=VALUE(C1)` | "123" | 123 | P1 |
| TC-164 | 日期数值 | `=D1+1` | 2024-01-15 | 2024-01-16 | P0 |
| TC-165 | 逻辑值计算 | `=SUM(E1:E5)` | TRUE,FALSE,1,2,3 | 6（TRUE=1,FALSE=0） | P2 |
| TC-166 | 混合类型计数 | `=COUNTA(F1:F10)` | 数字,文本,日期,空 | 非空数量 | P0 |

### 4.3 大数据量测试

| 用例ID | 测试场景 | 公式示例 | 数据规模 | 性能要求 | 优先级 |
|--------|----------|----------|----------|----------|--------|
| TC-167 | 大范围求和 | `=SUM(A1:A100000)` | 10万行 | <2秒 | P1 |
| TC-168 | 大表VLOOKUP | `=VLOOKUP(B1,C1:D100000,2,0)` | 10万行查找表 | <3秒 | P1 |
| TC-169 | 大范围COUNTIF | `=COUNTIF(E1:E100000,">1000")` | 10万行 | <2秒 | P1 |
| TC-170 | 大范围数组公式 | `{=SUM((A1:A10000>100)*B1:B10000)}` | 1万行数组 | <5秒 | P2 |
| TC-171 | 大范围SUMPRODUCT | `=SUMPRODUCT((F1:F50000="A")*G1:G50000)` | 5万行 | <3秒 | P2 |

### 4.4 Excel 2016系统限制

| 用例ID | 测试项 | 限制值 | 测试方法 | 预期结果 | 优先级 |
|--------|--------|--------|----------|----------|--------|
| TC-172 | 最大行数 | 1,048,576 | 在XFD行输入数据 | 正常工作 | P2 |
| TC-173 | 最大列数 | 16,384 (XFD) | 在XFD列输入数据 | 正常工作 | P2 |
| TC-174 | 公式长度 | 8,192字符 | 创建超长公式 | 接受或警告 | P2 |
| TC-175 | 嵌套层数 | 64层 | 嵌套64层IF | 正常计算 | P2 |
| TC-176 | 单元格字符数 | 32,767 | 输入超长文本 | 接受或截断 | P2 |

### 4.5 特殊字符处理

| 用例ID | 测试场景 | 公式示例 | 测试数据 | 预期结果 | 优先级 |
|--------|----------|----------|----------|----------|--------|
| TC-177 | 换行符处理 | `=SUBSTITUTE(A1,CHAR(10)," ")` | 包含换行的文本 | 替换换行符 | P1 |
| TC-178 | 制表符处理 | `=SUBSTITUTE(B1,CHAR(9),"")` | 包含Tab的文本 | 删除Tab | P1 |
| TC-179 | 通配符匹配 | `=COUNTIF(C:C,"*销售*")` | 包含"销售"的文本 | 匹配数量 | P1 |
| TC-180 | 问号通配符 | `=COUNTIF(D:D,"???")` | 3字符文本 | 匹配数量 | P1 |
| TC-181 | 特殊符号查找 | `=COUNTIF(E:E,"*~**")` | 包含*的文本 | 使用~转义 | P2 |

### 4.6 循环引用测试

| 用例ID | 测试场景 | 设置 | 预期结果 | 优先级 |
|--------|----------|------|----------|--------|
| TC-182 | 简单循环引用 | A1=B1, B1=A1 | 显示循环引用警告 | P1 |
| TC-183 | 启用迭代计算 | 文件→选项→公式→启用 | 可进行迭代 | P2 |
| TC-184 | 迭代次数限制 | 设置最大迭代100次 | 按设置迭代 | P2 |

---

## 5. 实际业务场景

### 5.1 财务报表场景

#### 场景描述：月度收支表

```
   A          B        C        D        E
1  日期       收入     支出     结余     累计
2  2024-01-01 5000     3000     =B2-C2   =D2
3  2024-01-02 3000     2000     =B3-C3   =E2+D3
4  2024-01-03 4000     2500     =B4-C4   =E3+D4
...
30 总计       =SUM(B2:B30) =SUM(C2:C30) =SUM(D2:D30)
```

| 用例ID | 测试项 | 公式 | 验证点 |
|--------|--------|------|--------|
| TC-185 | 日结余 | `=B2-C2` | 收支差额 |
| TC-186 | 累计结余 | `=E2+D3` | 滚动累加 |
| TC-187 | 月度汇总 | `=SUM(B2:B30)` | 总收入 |
| TC-188 | 收支比 | `=C30/B30` | 支出占比 |
| TC-189 | 平均日收入 | `=AVERAGE(B2:B30)` | 日均收入 |
| TC-190 | 最高收入日 | `=INDEX(A2:A30,MATCH(MAX(B2:B30),B2:B30,0))` | 最高日期 |

### 5.2 销售业绩分析

#### 场景描述：销售员业绩表

```
   A        B        C        D        E        F
1  销售员   销售额   目标     完成率   排名     等级
2  张三     120000   100000   =B2/C2   =RANK(B2,$B$2:$B$10) =IF(D2>=1.2,"S",IF(D2>=1,"A","B"))
3  李四     95000    100000   =B3/C3   =RANK(B3,$B$2:$B$10) =IF(D3>=1.2,"S",IF(D3>=1,"A","B"))
...
```

| 用例ID | 测试项 | 公式 | 验证点 |
|--------|--------|------|--------|
| TC-191 | 完成率 | `=B2/C2` | 百分比计算 |
| TC-192 | 销售排名 | `=RANK(B2,$B$2:$B$10)` | 排名计算 |
| TC-193 | 等级评定 | `=IF(D2>=1.2,"S",IF(D2>=1,"A","B"))` | 多级判断 |
| TC-194 | 达标人数 | `=COUNTIF(D:D,">=1")` | 达标统计 |
| TC-195 | 平均完成率 | `=AVERAGE(D2:D10)` | 团队平均 |
| TC-196 | TOP3总额 | `=SUMIF(F:F,"S",B:B)` | S级总销售 |

### 5.3 库存管理场景

#### 场景描述：进销存表

```
   A        B      C      D      E        F
1  产品     期初   入库   出库   期末     状态
2  产品A    100    50     80     =B2+C2-D2  =IF(E2<20,"预警","正常")
3  产品B    200    100    150    =B3+C3-D3  =IF(E3<50,"预警","正常")
...
```

| 用例ID | 测试项 | 公式 | 验证点 |
|--------|--------|------|--------|
| TC-197 | 期末库存 | `=B2+C2-D2` | 库存计算 |
| TC-198 | 库存预警 | `=IF(E2<20,"预警","正常")` | 预警判断 |
| TC-199 | 预警产品数 | `=COUNTIF(F:F,"预警")` | 预警统计 |
| TC-200 | 库存总值 | `=SUMPRODUCT(E2:E10,单价)` | 金额计算 |
| TC-201 | 周转率 | `=D2/((B2+E2)/2)` | 周转计算 |
| TC-202 | 安全库存比 | `=E2/安全库存` | 库存比例 |

### 5.4 考勤统计场景

#### 场景描述：月度考勤表

```
   A      B    C    D    ...  AF   AG       AH
1  姓名   1日  2日  3日  ...  31日 出勤天数 全勤奖
2  张三   √    √    ×   ...  √    =COUNTIF(B2:AF2,"√")  =IF(AG2>=30,500,0)
```

| 用例ID | 测试项 | 公式 | 验证点 |
|--------|--------|------|--------|
| TC-203 | 出勤统计 | `=COUNTIF(B2:AF2,"√")` | 符号计数 |
| TC-204 | 缺勤统计 | `=COUNTIF(B2:AF2,"×")` | 缺勤天数 |
| TC-205 | 全勤奖 | `=IF(AG2>=30,500,0)` | 奖金计算 |
| TC-206 | 出勤率 | `=AG2/31` | 百分比 |
| TC-207 | 全勤人数 | `=COUNTIF(AG:AG,">=30")` | 全勤统计 |

### 5.5 项目进度跟踪

#### 场景描述：项目任务表

```
   A        B          C          D        E        F
1  任务     开始日期   结束日期   工期     进度%    状态
2  需求分析 2024-01-01 2024-01-05 =C2-B2+1 100%     =IF(E2=1,"完成",IF(TODAY()>C2,"延期","进行中"))
```

| 用例ID | 测试项 | 公式 | 验证点 |
|--------|--------|------|--------|
| TC-208 | 工期计算 | `=C2-B2+1` | 日期差 |
| TC-209 | 状态判断 | `=IF(E2=1,"完成",IF(TODAY()>C2,"延期","进行中"))` | 多状态 |
| TC-210 | 完成任务数 | `=COUNTIF(F:F,"完成")` | 完成统计 |
| TC-211 | 总工期 | `=SUM(D2:D10)` | 工期汇总 |
| TC-212 | 整体进度 | `=AVERAGE(E2:E10)` | 平均进度 |
| TC-213 | 预计完成日 | `=MAX(C2:C10)` | 最晚日期 |

---

## 6. 测试数据准备

### 6.1 标准测试数据集

#### 数据集1：数值数据
```
文件名: test_data_numeric.xlsx
内容:
- 正整数: 1, 10, 100, 1000, 10000
- 负整数: -1, -10, -100
- 小数: 0.1, 1.5, 3.14159, 99.99
- 零值: 0
- 极大值: 9.99E+307
- 极小值: 1E-307
```

#### 数据集2：文本数据
```
文件名: test_data_text.xlsx
内容:
- 中文: "张三", "北京", "优秀"
- 英文: "Excel", "SUM", "VLOOKUP"
- 数字文本: "123", "001", "2024-01-01"
- 特殊字符: "*", "?", "~", "&"
- 空格文本: " text ", "  ", ""
- 换行文本: "第一行\n第二行"
```

#### 数据集3：日期数据
```
文件名: test_data_date.xlsx
内容:
- 标准日期: 2024-01-01, 2024-12-31
- 闰年日期: 2024-02-29
- 日期边界: 1900-01-01, 9999-12-31
- 时间: 14:30:00, 23:59:59
- 日期时间: 2024-01-01 14:30:00
```

#### 数据集4：混合数据
```
文件名: test_data_mixed.xlsx
内容:
行1-10: 数值
行11-20: 文本
行21-30: 日期
行31-40: 空单元格
行41-50: 错误值(#DIV/0!, #N/A, #VALUE!)
```

### 6.2 大数据测试集

```
文件名: test_data_large.xlsx
规模:
- Sheet1: 10万行 x 10列数值数据
- Sheet2: 10万行 x 5列文本数据
- Sheet3: 5万行查找表
- Sheet4: 包含1000个公式的复杂计算表
```

### 6.3 业务场景数据

```
文件名: test_data_business.xlsx
包含:
- Sheet1: 销售数据（100条记录）
- Sheet2: 库存数据（50种产品）
- Sheet3: 财务数据（12个月 x 30天）
- Sheet4: 考勤数据（20人 x 31天）
- Sheet5: 项目数据（15个任务）
```

---

## 7. 测试执行指南

### 7.1 测试优先级说明

- **P0（高优先级）**: 核心基础功能，必须通过
  - 基础数学函数（SUM, AVERAGE, COUNT等）
  - 核心逻辑函数（IF, IFERROR）
  - VLOOKUP查找
  - 固定表头常用场景

- **P1（中优先级）**: 常用功能，建议通过
  - 组合公式
  - 条件统计函数（SUMIF, COUNTIF等）
  - INDEX+MATCH
  - 日期函数
  - 动态表头场景

- **P2（低优先级）**: 高级功能，可选测试
  - 复杂数组公式
  - 性能测试
  - 系统限制测试
  - 特殊场景

### 7.2 测试环境要求

#### 必需环境
- Microsoft Excel 2016 (版本号: 16.0.xxxx)
- Windows 7/8/10 或 macOS
- 内存: 至少4GB
- 硬盘空间: 至少500MB

#### 可选环境（对比测试）
- WPS Office 2016
- LibreOffice Calc 6.x
- Google Sheets（在线）

### 7.3 测试步骤

#### 手动测试流程
1. **准备阶段**
   - 创建测试工作簿
   - 准备测试数据
   - 记录Excel版本信息

2. **执行阶段**
   - 按用例ID顺序测试
   - 输入测试数据
   - 输入公式
   - 验证结果
   - 记录实际结果

3. **验证阶段**
   - 对比预期结果
   - 检查计算精度
   - 验证错误处理
   - 测试性能表现

4. **记录阶段**
   - 标记通过/失败
   - 记录失败原因
   - 截图保存证据
   - 填写测试报告

#### 自动化测试（VBA脚本）
```vba
' 示例: 批量执行测试用例的VBA代码
Sub RunTestCases()
    Dim ws As Worksheet
    Set ws = ThisWorkbook.Sheets("TestResults")

    ' TC-001: SUM函数测试
    Range("A1:A10").Value = Array(1,2,3,4,5,6,7,8,9,10)
    Range("A11").Formula = "=SUM(A1:A10)"
    If Range("A11").Value = 55 Then
        ws.Range("B1").Value = "PASS"
    Else
        ws.Range("B1").Value = "FAIL"
    End If

    ' 继续其他测试用例...
End Sub
```

### 7.4 测试结果记录模板

| 用例ID | 测试日期 | 测试人 | 实际结果 | 预期结果 | 状态 | 备注 |
|--------|----------|--------|----------|----------|------|------|
| TC-001 | 2024-01-07 | 张三 | 55 | 55 | PASS | - |
| TC-045 | 2024-01-07 | 张三 | #N/A | 对应值 | FAIL | 查找表数据错误 |

### 7.5 常见问题排查

#### 问题1: 公式返回#VALUE!错误
- **原因**: 数据类型不匹配
- **检查**: 确认单元格是数值还是文本
- **解决**: 使用VALUE()转换或调整数据格式

#### 问题2: VLOOKUP返回#N/A
- **原因**: 查找值不存在或数据格式不一致
- **检查**: 查找值是否包含多余空格
- **解决**: 使用TRIM()清理数据，或用IFERROR包装

#### 问题3: 数组公式不生效
- **原因**: 未按Ctrl+Shift+Enter输入
- **检查**: 公式栏是否有{花括号}
- **解决**: 重新输入并按Ctrl+Shift+Enter

#### 问题4: 日期显示为数字
- **原因**: 单元格格式设置错误
- **检查**: 右键→设置单元格格式
- **解决**: 设置为日期格式

#### 问题5: 公式计算结果不更新
- **原因**: 计算模式设置为手动
- **检查**: 文件→选项→公式→计算选项
- **解决**: 改为自动计算或按F9强制计算

---

## 8. 测试报告模板

### 8.1 测试摘要

```
项目名称: Excel 2016系统测试
测试时间: 2024-01-07 至 2024-01-14
测试人员: 张三、李四
测试环境: Windows 10 + Excel 2016 (16.0.5134.1000)

测试统计:
- 总用例数: 213
- 通过数: 205
- 失败数: 8
- 跳过数: 0
- 通过率: 96.2%
```

### 8.2 缺陷统计

| 严重级别 | 数量 | 占比 |
|----------|------|------|
| 致命 | 0 | 0% |
| 严重 | 2 | 25% |
| 一般 | 4 | 50% |
| 轻微 | 2 | 25% |
| **总计** | **8** | **100%** |

### 8.3 测试结论

✅ **通过模块**:
- 基础数学函数 (100%)
- 逻辑函数 (100%)
- 文本函数 (100%)
- 固定表头场景 (100%)

⚠️ **部分通过模块**:
- 查找函数 (95% - 大数据量性能问题)
- 数组公式 (90% - 复杂嵌套限制)

❌ **未通过项**:
- 无

### 8.4 建议

1. 建议在处理10万行以上数据时使用Power Query
2. 复杂数组公式考虑拆分为多个步骤
3. 重要公式添加IFERROR错误处理
4. 定期检查循环引用警告

---

## 9. 附录

### 9.1 Excel 2016快捷键

| 快捷键 | 功能 |
|--------|------|
| Ctrl+Shift+Enter | 输入数组公式 |
| F9 | 强制重新计算 |
| Ctrl+` | 显示/隐藏公式 |
| F2 | 编辑单元格 |
| Ctrl+Shift+$ | 应用货币格式 |
| Ctrl+Shift+% | 应用百分比格式 |
| Alt+= | 快速求和 |
| Ctrl+; | 输入当前日期 |
| Ctrl+Shift+: | 输入当前时间 |

### 9.2 公式审核工具

1. **公式→追踪引用单元格**: 查看公式引用了哪些单元格
2. **公式→追踪从属单元格**: 查看哪些公式引用了当前单元格
3. **公式→公式求值**: 逐步查看公式计算过程
4. **公式→错误检查**: 检查工作表中的公式错误

### 9.3 常用函数速查表

| 分类 | 函数 | Excel 2016支持 |
|------|------|----------------|
| 求和 | SUM, SUMIF, SUMIFS, SUMPRODUCT | ✅ |
| 平均 | AVERAGE, AVERAGEIF, AVERAGEIFS | ✅ |
| 计数 | COUNT, COUNTA, COUNTIF, COUNTIFS | ✅ |
| 查找 | VLOOKUP, HLOOKUP, INDEX, MATCH | ✅ |
| 查找 | XLOOKUP | ❌ (仅365) |
| 逻辑 | IF, AND, OR, NOT, IFERROR, IFNA | ✅ |
| 逻辑 | IFS, SWITCH | ❌ (仅365) |
| 文本 | CONCATENATE, LEFT, RIGHT, MID, TEXT | ✅ |
| 文本 | TEXTJOIN, CONCAT | ❌ (仅365) |
| 日期 | TODAY, DATE, YEAR, MONTH, DAY, DATEDIF | ✅ |
| 动态数组 | FILTER, SORT, UNIQUE | ❌ (仅365) |

---

**文档维护**
- 下次更新时间: 2024-04-07
- 维护负责人: 测试团队
- 版本历史:
  - v1.0 (2024-01-07): 初始版本

---

**结束**
